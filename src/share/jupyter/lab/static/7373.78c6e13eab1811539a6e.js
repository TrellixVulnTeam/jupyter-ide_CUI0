(self["webpackChunk_jupyterlab_application_top"]=self["webpackChunk_jupyterlab_application_top"]||[]).push([[7373],{47373:(e,t,s)=>{"use strict";s.r(t);s.d(t,{YBaseCell:()=>g,YCodeCell:()=>y,YDocument:()=>l,YFile:()=>c,YMarkdownCell:()=>p,YNotebook:()=>d,YRawCell:()=>m,convertYMapEventToMapChange:()=>M,createCellFromType:()=>h,createMutex:()=>w,createStandaloneCell:()=>u});var n=s(9727);var a=s(75138);var o=s(6493);var r=s(11038);const i=e=>JSON.parse(JSON.stringify(e));class l{constructor(){this.isDisposed=false;this.ydoc=new r.Doc;this.source=this.ydoc.getText("source");this.ystate=this.ydoc.getMap("state");this.undoManager=new r.UndoManager([this.source],{trackedOrigins:new Set([this])});this.awareness=new o.GL(this.ydoc);this._changed=new a.Signal(this)}get dirty(){return this.ystate.get("dirty")}set dirty(e){this.transact((()=>{this.ystate.set("dirty",e)}),false)}transact(e,t=true){this.ydoc.transact(e,t?this:null)}dispose(){this.isDisposed=true;this.ydoc.destroy()}canUndo(){return this.undoManager.undoStack.length>0}canRedo(){return this.undoManager.redoStack.length>0}undo(){this.undoManager.undo()}redo(){this.undoManager.redo()}clearUndoHistory(){this.undoManager.clear()}get changed(){return this._changed}}class c extends l{constructor(){super();this._modelObserver=e=>{const t={};t.sourceChange=e.changes.delta;this._changed.emit(t)};this._onStateChanged=e=>{const t=[];e.keysChanged.forEach((s=>{const n=e.changes.keys.get(s);if(n){t.push({name:s,oldValue:n.oldValue,newValue:this.ystate.get(s)})}}));this._changed.emit({stateChange:t})};this.ysource=this.ydoc.getText("source");this.ysource.observe(this._modelObserver);this.ystate.observe(this._onStateChanged)}dispose(){this.ysource.unobserve(this._modelObserver);this.ystate.unobserve(this._onStateChanged)}static create(){return new c}getSource(){return this.ysource.toString()}setSource(e){this.transact((()=>{const t=this.ysource;t.delete(0,t.length);t.insert(0,e)}))}updateSource(e,t,s=""){this.transact((()=>{const n=this.ysource;n.insert(e,s);n.delete(e+s.length,t-e)}))}}class d extends l{constructor(e){super();this._onYCellsChanged=e=>{e.changes.added.forEach((e=>{const t=e.content.type;if(!this._ycellMapping.has(t)){this._ycellMapping.set(t,h(t))}const s=this._ycellMapping.get(t);s._notebook=this;if(!this.disableDocumentWideUndoRedo){s._undoManager=this.undoManager}else{s._undoManager=new r.UndoManager([s.ymodel],{})}}));e.changes.deleted.forEach((e=>{const t=e.content.type;const s=this._ycellMapping.get(t);if(s){s.dispose();this._ycellMapping.delete(t)}}));let t=0;const s=[];e.changes.delta.forEach((e=>{if(e.insert!=null){const n=e.insert.map((e=>this._ycellMapping.get(e)));s.push({insert:n});this.cells.splice(t,0,...n);t+=e.insert.length}else if(e.delete!=null){s.push(e);this.cells.splice(t,e.delete)}else if(e.retain!=null){s.push(e);t+=e.retain}}));this._changed.emit({cellsChange:s})};this._onMetadataChanged=e=>{if(e.keysChanged.has("metadata")){const t=e.changes.keys.get("metadata");const s={oldValue:(t===null||t===void 0?void 0:t.oldValue)?t.oldValue:undefined,newValue:this.getMetadata()};this._changed.emit({metadataChange:s})}};this._onStateChanged=e=>{const t=[];e.keysChanged.forEach((s=>{const n=e.changes.keys.get(s);if(n){t.push({name:s,oldValue:n.oldValue,newValue:this.ystate.get(s)})}}));this._changed.emit({stateChange:t})};this.ycells=this.ydoc.getArray("cells");this.ymeta=this.ydoc.getMap("meta");this.ymodel=this.ydoc.getMap("model");this.undoManager=new r.UndoManager([this.ycells],{trackedOrigins:new Set([this])});this._ycellMapping=new Map;this._disableDocumentWideUndoRedo=e.disableDocumentWideUndoRedo;this.ycells.observe(this._onYCellsChanged);this.cells=this.ycells.toArray().map((e=>{if(!this._ycellMapping.has(e)){this._ycellMapping.set(e,h(e))}return this._ycellMapping.get(e)}));this.ymeta.observe(this._onMetadataChanged);this.ystate.observe(this._onStateChanged)}get nbformat(){return this.ystate.get("nbformat")}set nbformat(e){this.transact((()=>{this.ystate.set("nbformat",e)}),false)}get nbformat_minor(){return this.ystate.get("nbformatMinor")}set nbformat_minor(e){this.transact((()=>{this.ystate.set("nbformatMinor",e)}),false)}dispose(){this.ycells.unobserve(this._onYCellsChanged);this.ymeta.unobserve(this._onMetadataChanged);this.ystate.unobserve(this._onStateChanged)}getCell(e){return this.cells[e]}insertCell(e,t){this.insertCells(e,[t])}insertCells(e,t){t.forEach((e=>{this._ycellMapping.set(e.ymodel,e);if(!this.disableDocumentWideUndoRedo){e.undoManager=this.undoManager}}));this.transact((()=>{this.ycells.insert(e,t.map((e=>e.ymodel)))}))}moveCell(e,t){this.transact((()=>{const s=this.getCell(e).clone();this.deleteCell(e);this.insertCell(t,s)}))}deleteCell(e){this.deleteCellRange(e,e+1)}deleteCellRange(e,t){this.transact((()=>{this.ycells.delete(e,t-e)}))}getMetadata(){const e=this.ymeta.get("metadata");return e?i(e):{}}setMetadata(e){this.ymeta.set("metadata",i(e))}updateMetadata(e){this.ymeta.set("metadata",Object.assign({},this.getMetadata(),e))}static create(e){return new d({disableDocumentWideUndoRedo:e})}get disableDocumentWideUndoRedo(){return this._disableDocumentWideUndoRedo}}const h=e=>{switch(e.get("cell_type")){case"code":return new y(e);case"markdown":return new p(e);case"raw":return new m(e);default:throw new Error("Found unknown cell type")}};const u=(e,t)=>{switch(e){case"markdown":return p.createStandalone(t);case"code":return y.createStandalone(t);default:return m.createStandalone(t)}};class g{constructor(e){this._notebook=null;this.isStandalone=false;this._modelObserver=e=>{const t={};const s=e.find((e=>e.target===this.ymodel.get("source")));if(s){t.sourceChange=s.changes.delta}const n=e.find((e=>e.target===this.ymodel.get("outputs")));if(n){t.outputsChange=n.changes.delta}const a=e.find((e=>e.target===this.ymodel));if(a&&a.keysChanged.has("metadata")){const e=a.changes.keys.get("metadata");t.metadataChange={oldValue:(e===null||e===void 0?void 0:e.oldValue)?e.oldValue:undefined,newValue:this.getMetadata()}}if(a&&a.keysChanged.has("execution_count")){const e=a.changes.keys.get("execution_count");t.executionCountChange={oldValue:e.oldValue,newValue:this.ymodel.get("execution_count")}}const o=this.ymodel.get("source");if(a&&a.keysChanged.has("source")){t.sourceChange=[{delete:this._prevSourceLength},{insert:o.toString()}]}this._prevSourceLength=o.length;this._changed.emit(t)};this.isDisposed=false;this._undoManager=null;this._changed=new a.Signal(this);this.ymodel=e;const t=e.get("source");this._prevSourceLength=t?t.length:0;this.ymodel.observeDeep(this._modelObserver);this._awareness=null}get ysource(){return this.ymodel.get("source")}get awareness(){var e,t,s;return(s=(e=this._awareness)!==null&&e!==void 0?e:(t=this.notebook)===null||t===void 0?void 0:t.awareness)!==null&&s!==void 0?s:null}transact(e,t=true){this.notebook&&t?this.notebook.transact(e):this.ymodel.doc.transact(e,this)}get undoManager(){var e;if(!this.notebook){return this._undoManager}return((e=this.notebook)===null||e===void 0?void 0:e.disableDocumentWideUndoRedo)?this._undoManager:this.notebook.undoManager}set undoManager(e){this._undoManager=e}undo(){var e;(e=this.undoManager)===null||e===void 0?void 0:e.undo()}redo(){var e;(e=this.undoManager)===null||e===void 0?void 0:e.redo()}canUndo(){return!!this.undoManager&&this.undoManager.undoStack.length>0}canRedo(){return!!this.undoManager&&this.undoManager.redoStack.length>0}clearUndoHistory(){var e;(e=this.undoManager)===null||e===void 0?void 0:e.clear()}get notebook(){return this._notebook}static create(e=n.UUID.uuid4()){const t=new r.Map;const s=new r.Text;t.set("source",s);t.set("metadata",{});t.set("cell_type",this.prototype.cell_type);t.set("id",e);return new this(t)}static createStandalone(e){const t=this.create(e);t.isStandalone=true;const s=new r.Doc;s.getArray().insert(0,[t.ymodel]);t._awareness=new o.GL(s);t._undoManager=new r.UndoManager([t.ymodel],{trackedOrigins:new Set([t])});return t}clone(){const e=new r.Map;const t=new r.Text(this.getSource());e.set("source",t);e.set("metadata",this.getMetadata());e.set("cell_type",this.cell_type);e.set("id",this.getId());const s=this.constructor;const n=new s(e);n._undoManager=this.undoManager;return n}get changed(){return this._changed}dispose(){this.ymodel.unobserveDeep(this._modelObserver)}getAttachments(){return this.ymodel.get("attachments")}setAttachments(e){this.transact((()=>{if(e==null){this.ymodel.delete("attachments")}else{this.ymodel.set("attachments",e)}}))}getId(){return this.ymodel.get("id")}getSource(){return this.ymodel.get("source").toString()}setSource(e){const t=this.ymodel.get("source");this.transact((()=>{t.delete(0,t.length);t.insert(0,e)}))}updateSource(e,t,s=""){this.transact((()=>{const n=this.ysource;n.insert(e,s);n.delete(e+s.length,t-e)}))}get cell_type(){throw new Error("A YBaseCell must not be constructed")}getMetadata(){return i(this.ymodel.get("metadata"))}setMetadata(e){this.transact((()=>{this.ymodel.set("metadata",i(e))}))}toJSON(){return{id:this.getId(),cell_type:this.cell_type,source:this.getSource(),metadata:this.getMetadata()}}}class y extends g{get cell_type(){return"code"}get execution_count(){return this.ymodel.get("execution_count")}set execution_count(e){this.transact((()=>{this.ymodel.set("execution_count",e)}))}getOutputs(){return i(this.ymodel.get("outputs").toArray())}setOutputs(e){const t=this.ymodel.get("outputs");this.transact((()=>{t.delete(0,t.length);t.insert(0,e)}),false)}updateOutputs(e,t,s=[]){const n=this.ymodel.get("outputs");const a=t<n.length?t-e:n.length-e;this.transact((()=>{n.delete(e,a);n.insert(e,s)}),false)}static create(e){const t=super.create(e);t.ymodel.set("execution_count",0);t.ymodel.set("outputs",new r.Array);return t}static createStandalone(e){const t=super.createStandalone(e);t.ymodel.set("execution_count",null);t.ymodel.set("outputs",new r.Array);return t}clone(){const e=super.clone();const t=new r.Array;t.insert(0,this.getOutputs());e.ymodel.set("execution_count",this.execution_count);e.ymodel.set("outputs",t);return e}toJSON(){return{id:this.getId(),cell_type:"code",source:this.getSource(),metadata:this.getMetadata(),outputs:this.getOutputs(),execution_count:this.execution_count}}}class m extends g{static create(e){return super.create(e)}static createStandalone(e){return super.createStandalone(e)}get cell_type(){return"raw"}toJSON(){return{id:this.getId(),cell_type:"raw",source:this.getSource(),metadata:this.getMetadata(),attachments:this.getAttachments()}}}class p extends g{static create(e){return super.create(e)}static createStandalone(e){return super.createStandalone(e)}get cell_type(){return"markdown"}toJSON(){return{id:this.getId(),cell_type:"markdown",source:this.getSource(),metadata:this.getMetadata(),attachments:this.getAttachments()}}}const _=null&&d;function M(e){let t=new Map;e.changes.keys.forEach(((e,s)=>{t.set(s,{action:e.action,oldValue:e.oldValue,newValue:this.ymeta.get(s)})}));return t}const w=()=>{let e=true;return t=>{if(e){e=false;try{t()}finally{e=true}}}}}}]);